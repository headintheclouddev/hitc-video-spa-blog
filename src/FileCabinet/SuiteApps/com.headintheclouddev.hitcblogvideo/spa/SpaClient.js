define(["exports","@uif-js/core/jsx-runtime","@uif-js/core","N/query","N/record","N","@uif-js/component"],(function(e,t,n,s,o,r,i){"use strict";const c=n.ContextType.new("theme-context"),a={CREATE_POST:Symbol("createPost"),FETCH_POSTS:Symbol("fetchPosts"),USER_REGISTER:Symbol("userRegister"),USER_LOGIN:Symbol("userLogin"),USER_LOGOUT:Symbol("userLogout")},u={createPost(e,t,n){const s=Date.now();return{type:a.CREATE_POST,id:s,title:e,content:t,author:n}},fetchPosts:()=>async e=>{const t=(await s.runSuiteQL.promise({query:"\n          SELECT id, name AS title, custrecord_blog_content AS content, BUILTIN.DF(owner) AS author\n          FROM customrecord_blog_post\n          WHERE isInactive = 'F'\n          ORDER BY id DESC\n        "})).asMappedResults();e({type:a.FETCH_POSTS,posts:t})},userRegister:(e,t)=>async n=>{const s=await o.create.promise({type:"contact"});s.setValue("subsidiary","1"),s.setValue("entityid",e),s.setValue("custentity_blog_password",t);const r=await s.save.promise();console.log("Successfully created contact",r),n({type:a.USER_REGISTER,username:e})},userLogin:(e,t)=>async n=>{0==(await s.runSuiteQL.promise({query:"SELECT id FROM contact WHERE entityid = ? AND custentity_blog_password = ?",params:[e,t]})).asMappedResults().length?n({type:a.USER_LOGIN,username:""}):n({type:a.USER_LOGIN,username:e})},userLogout:()=>({type:a.USER_LOGOUT})};function l(e,t){return{user:d(e.user,t),posts:x(e.posts,t),error:""}}function d(e,t){switch(t.type){case a.USER_LOGIN:case a.USER_REGISTER:return t.username;case a.USER_LOGOUT:return"";default:return e}}function x(e,t){if(t.type==a.CREATE_POST){return[{title:t.title,content:t.content,author:t.author,id:t.id},...e]}return t.type==a.FETCH_POSTS?t.posts:e}const h={HOMEPAGE:"/",POST:"/view/:id"};function p(e){return t.jsxs("span",{onClick:e.onClick,style:{cursor:"pointer",paddingLeft:"8px",fontWeight:e.active?"bold":"normal"},children:[t.jsx("span",{style:{color:e.theme.primaryColor},children:"Primary"})," / ",t.jsx("span",{style:{color:e.theme.secondaryColor},children:"Secondary"})]})}function m(e){const[s,o]=n.useState([]);function i(t){return t.primaryColor==e.theme.primaryColor&&t.secondaryColor==e.theme.secondaryColor}return n.useEffect((()=>{r.query.runSuiteQL.promise({query:"SELECT name, id, custrecord_blog_theme_secondary_color FROM customrecord_blog_theme"}).then((e=>{const t=e.asMappedResults(),n=[];for(const e of t)n.push({id:e.id,primaryColor:e.name,secondaryColor:e.custrecord_blog_theme_secondary_color});o(n),console.log("ChangedTheme found",t.length,"themes")}))}),[]),t.jsxs("div",{children:["Change Theme:",s.map((n=>t.jsx(p,{theme:n,active:i(n),onClick:()=>e.setTheme(n)})))]})}function j(){const[e,s]=n.useState(""),[o,r]=n.useState(""),c=n.useDispatch(),a={[i.TextBox.Event.TEXT_CHANGED]:({text:e})=>{s(e)}};return t.jsxs("div",{children:[t.jsx("label",{htmlFor:"login-username",children:"Username:"}),t.jsx(i.TextBox,{type:i.TextBox.Type.TEXT,name:"login-username",text:e,on:a}),t.jsx("label",{htmlFor:"login-password",children:"Password:"}),t.jsx(i.TextBox,{type:i.TextBox.Type.PASSWORD,name:"login-password",text:o,onTextChanged:function(e){r(e.text)}}),t.jsx("input",{type:"button",value:"Login",onClick:function(){console.log("handleLogin running"),e&&o&&c(u.userLogin(e,o))}})]})}function S(){const[e,s]=n.useState(""),[o,r]=n.useState(""),[c,a]=n.useState(""),l=n.useDispatch(),d={[i.TextBox.Event.TEXT_CHANGED]:({text:e})=>{console.log("Login username changed to",e),s(e)}};return t.jsxs("div",{children:[t.jsx("label",{htmlFor:"register-username",children:"Username:"}),t.jsx(i.TextBox,{type:i.TextBox.Type.TEXT,name:"register-username",text:e,on:d}),t.jsx("label",{htmlFor:"register-password",children:"Password:"}),t.jsx(i.TextBox,{type:i.TextBox.Type.PASSWORD,name:"register-password",text:o,onTextChanged:function(e){r(e.text)}}),t.jsx("label",{htmlFor:"register-repeat-password",children:"Repeat Password:"}),t.jsx(i.TextBox,{type:i.TextBox.Type.PASSWORD,name:"register-reeat-password",text:c,onTextChanged:function(e){a(e.text)}}),t.jsx(i.Button,{label:"Register",action:function(){console.log("handleRegister running"),l(u.userRegister(e,o))},enabled:e.length>0&&o.length>0&&o==c})]})}function g(){const e=n.useSelector((e=>e.user)),s=n.useDispatch();return t.jsxs("div",{children:["Logged in as: ",t.jsx("b",{children:e})," ",t.jsx(i.Button,{label:"Logout",action:function(){s(u.userLogout())}})]})}function T(){return n.useSelector((e=>e.user))?t.jsx(n.VDom.Fragment,{children:t.jsx(g,{})}):t.jsxs(n.VDom.Fragment,{children:[t.jsx(j,{}),t.jsx(S,{})]})}function y(){const[e,s]=n.useState(""),[o,r]=n.useState(""),c=n.useDispatch(),a=n.useSelector((e=>e.user));if(!a)return t.jsx("p",{children:"Please log in to create a post."});return t.jsxs("div",{children:[t.jsxs("div",{children:["Author: ",t.jsx("b",{children:a})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"create-title",children:"Title:"}),t.jsx(i.TextBox,{type:i.TextBox.Type.TEXT,name:"create-title",text:e,onTextChanged:function(e){console.log("handleTitle"),s(e.text)}})]}),t.jsx(i.TextArea,{text:o,onTextChanged:function(e){console.log("handleContent"),r(e.text)}}),t.jsx("input",{type:"button",value:"Create",onClick:function(){e&&o&&c(u.createPost(e,o,a))}})]})}function E(e){return t.jsxs("div",{children:[t.jsx("h1",{style:{color:e.theme.primaryColor},children:"NetSuite Blog"}),t.jsx(m,{theme:e.theme,setTheme:e.setTheme}),t.jsx(T,{}),t.jsx(y,{})]})}function f(e){const{secondaryColor:s}=n.useContext(c);let o=e.content;return e.content.length>30&&(o=e.content.substring(0,30)+"..."),t.jsxs("div",{children:[t.jsx("h3",{style:{color:s},children:e.title}),t.jsx("div",{children:o}),t.jsxs("div",{children:[t.jsx("br",{}),t.jsx(i.Link,{route:{route:"/view/:id",parameters:{id:e.id}},children:"View full post"})]}),t.jsx("br",{}),t.jsxs("i",{children:["Written by ",t.jsx("b",{children:e.author})]})]})}function R(){const e=n.useSelector((e=>e.posts)),s=[];for(const o of e)s.push(t.jsxs(n.VDom.Fragment,{children:[t.jsx(f,{...o}),t.jsx("hr",{})]}));return t.jsx("div",{children:s})}function C(){return t.jsx("div",{children:t.jsx(R,{})})}function _(e){const[o,r]=n.useState(null);return n.useEffect((()=>{var t;t=e.id,s.runSuiteQL.promise({query:"SELECT id, name AS title, custrecord_blog_content AS content, BUILTIN.DF(owner) AS author FROM customrecord_blog_post WHERE id = ?",params:[t]}).then((e=>{const t=e.asMappedResults();t.length>0&&r({id:t[0].id,data:{title:t[0].title,content:t[0].content,author:t[0].author}})}))}),[e.id]),t.jsxs("div",{children:[t.jsx(i.Link,{route:{route:"/"},children:"Go back"}),o&&o.data?t.jsx(f,{...o.data}):"Loading...",t.jsx("hr",{})]})}function b(){const[e,s]=n.useState({user:"",posts:[],error:""}),o=n.useMemo((()=>n.Store.create({reducer:l,state:e,onStateChanged:({currentState:e})=>s(e)})));n.useEffect((()=>o.subscribe((()=>s(o.getState())))),[]),n.useEffect((()=>{console.log("useEffect - fetchPosts",new Date),o.dispatch(u.fetchPosts())}),[]);const[r,i]=n.useState({primaryColor:"deepskyblue",secondaryColor:"coral"}),a={[c]:r};return t.jsx(n.Router.Hash,{children:t.jsx(n.Store.Provider,{store:o,children:t.jsx(n.VDom.Context,{value:a,children:t.jsxs("div",{children:[t.jsx(E,{setTheme:i,theme:r}),t.jsx("hr",{}),t.jsxs(n.Router.Routes,{children:[t.jsx(n.Router.Route,{path:h.HOMEPAGE,exact:!0,children:t.jsx(C,{})}),t.jsx(n.Router.Route,{path:h.POST,exact:!0,children:t.jsx(_,{})})]})]})})})})}e.run=function(e){console.log("SpaClient - run context",e),e.setLayout("application"),e.setContent(t.jsx(b,{}))}}));
