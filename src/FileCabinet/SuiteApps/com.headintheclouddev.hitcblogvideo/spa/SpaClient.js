define(["exports","@uif-js/core/jsx-runtime","@uif-js/core","N/query","N/record","N","@uif-js/component"],(function(e,t,o,s,r,n,c){"use strict";const i=o.ContextType.new("theme-context"),l={CREATE_POST:Symbol("createPost"),FETCH_POSTS:Symbol("fetchPosts"),USER_REGISTER:Symbol("userRegister"),USER_LOGIN:Symbol("userLogin"),USER_LOGOUT:Symbol("userLogout"),LOGIN_ERROR:Symbol("loginError")},a={createPost:(e,t,o)=>async s=>{r.create.promise({type:"customrecord_blog_post"}).then((r=>{r.setValue("name",e),r.setValue("custrecord_blog_content",t),r.save.promise().then((r=>{console.log("Successfully created blog post",r),s({type:l.CREATE_POST,id:r,title:e,content:t,author:o})})).catch((e=>{alert(e)}))}))},fetchPosts:()=>async e=>{const t=(await s.runSuiteQL.promise({query:"\n          SELECT id, name AS title, custrecord_blog_content AS content, BUILTIN.DF(owner) AS author\n          FROM customrecord_blog_post\n          WHERE isInactive = 'F'\n          ORDER BY id DESC\n        "})).asMappedResults();e({type:l.FETCH_POSTS,posts:t})},userRegister:(e,t)=>async o=>{const s=await r.create.promise({type:"contact"});s.setValue("subsidiary","1"),s.setValue("entityid",e),s.setValue("custentity_blog_password",t);const n=await s.save.promise();console.log("Successfully created contact",n),o({type:l.USER_REGISTER,username:e})},userLogin:(e,t)=>async o=>{0==(await s.runSuiteQL.promise({query:"SELECT id FROM contact WHERE entityid = ? AND custentity_blog_password = ?",params:[e,t]})).asMappedResults().length?o({type:l.LOGIN_ERROR,error:"Invalid username or password"}):(o({type:l.USER_LOGIN,username:e}),o({type:l.LOGIN_ERROR,error:""}))},userLogout:()=>({type:l.USER_LOGOUT})};function u(e,t){return{user:d(e.user,t),posts:x(e.posts,t),error:h(e.error,t)}}function d(e,t){switch(t.type){case l.USER_LOGIN:case l.USER_REGISTER:return t.username;case l.USER_LOGOUT:return"";default:return e}}function x(e,t){if(t.type==l.CREATE_POST){return[{title:t.title,content:t.content,author:t.author,id:t.id},...e]}return t.type==l.FETCH_POSTS?t.posts:e}function h(e,t){return t.type==l.LOGIN_ERROR?t.error:e}const p={HOMEPAGE:"/",POST:"/view/:id"};function m(e){return t.jsxs("span",{onClick:e.onClick,style:{cursor:"pointer",paddingLeft:"8px",fontWeight:e.active?"bold":"normal"},children:[t.jsx("span",{style:{color:e.theme.primaryColor},children:"Primary"})," / ",t.jsx("span",{style:{color:e.theme.secondaryColor},children:"Secondary"})]})}function g(e){const[s,r]=o.useState([]);function c(t){return t.primaryColor==e.theme.primaryColor&&t.secondaryColor==e.theme.secondaryColor}return o.useEffect((()=>{n.query.runSuiteQL.promise({query:"SELECT name, id, custrecord_blog_theme_secondary_color FROM customrecord_blog_theme"}).then((e=>{const t=e.asMappedResults(),o=[];for(const e of t)o.push({id:e.id,primaryColor:e.name,secondaryColor:e.custrecord_blog_theme_secondary_color});r(o),console.log("ChangedTheme found",t.length,"themes")}))}),[]),t.jsxs("div",{children:["Change Theme:",s.map((o=>t.jsx(m,{theme:o,active:c(o),onClick:()=>e.setTheme(o)})))]})}function j(){const[e,s]=o.useState(""),[r,n]=o.useState(""),i=o.useDispatch(),l=o.useSelector((e=>e.error)),u={[c.TextBox.Event.TEXT_CHANGED]:({text:e})=>{s(e)}};return t.jsxs("div",{children:[t.jsx("label",{htmlFor:"login-username",children:"Username:"}),t.jsx(c.TextBox,{type:c.TextBox.Type.TEXT,name:"login-username",text:e,on:u}),t.jsx("label",{htmlFor:"login-password",children:"Password:"}),t.jsx(c.TextBox,{type:c.TextBox.Type.PASSWORD,name:"login-password",text:r,onTextChanged:function(e){n(e.text)}}),t.jsx("input",{type:"button",value:"Login",onClick:function(){console.log("handleLogin running"),e&&r&&i(a.userLogin(e,r))}}),t.jsxs("span",{style:{color:"red"},children:[" ",l]})]})}function y(){const[e,s]=o.useState(""),[r,n]=o.useState(""),[i,l]=o.useState(""),u=o.useDispatch(),d={[c.TextBox.Event.TEXT_CHANGED]:({text:e})=>{console.log("Login username changed to",e),s(e)}};return t.jsxs("div",{children:[t.jsx("label",{htmlFor:"register-username",children:"Username:"}),t.jsx(c.TextBox,{type:c.TextBox.Type.TEXT,name:"register-username",text:e,on:d}),t.jsx("label",{htmlFor:"register-password",children:"Password:"}),t.jsx(c.TextBox,{type:c.TextBox.Type.PASSWORD,name:"register-password",text:r,onTextChanged:function(e){n(e.text)}}),t.jsx("label",{htmlFor:"register-repeat-password",children:"Repeat Password:"}),t.jsx(c.TextBox,{type:c.TextBox.Type.PASSWORD,name:"register-reeat-password",text:i,onTextChanged:function(e){l(e.text)}}),t.jsx(c.Button,{label:"Register",action:function(){console.log("handleRegister running"),u(a.userRegister(e,r))},enabled:e.length>0&&r.length>0&&r==i})]})}function S(){const e=o.useSelector((e=>e.user)),s=o.useDispatch();return t.jsxs("div",{children:["Logged in as: ",t.jsx("b",{children:e})," ",t.jsx(c.Button,{label:"Logout",action:function(){s(a.userLogout())}})]})}function T(){return o.useSelector((e=>e.user))?t.jsx(o.VDom.Fragment,{children:t.jsx(S,{})}):t.jsxs(o.VDom.Fragment,{children:[t.jsx(j,{}),t.jsx(y,{})]})}function E(){const[e,s]=o.useState(""),[r,n]=o.useState(""),i=o.useDispatch(),l=o.useSelector((e=>e.user));if(!l)return t.jsx("p",{children:"Please log in to create a post."});return t.jsxs("div",{children:[t.jsxs("div",{children:["Author: ",t.jsx("b",{children:l})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"create-title",children:"Title:"}),t.jsx(c.TextBox,{type:c.TextBox.Type.TEXT,name:"create-title",text:e,onTextChanged:function(e){console.log("handleTitle"),s(e.text)}})]}),t.jsx(c.TextArea,{text:r,onTextChanged:function(e){console.log("handleContent"),n(e.text)}}),t.jsx("input",{type:"button",value:"Create",onClick:function(){e&&r&&(i(a.createPost(e,r,l)),s(""),n(""))}})]})}function f(e){return t.jsxs("div",{children:[t.jsx("h1",{style:{color:e.theme.primaryColor},children:"NetSuite Blog"}),t.jsx(g,{theme:e.theme,setTheme:e.setTheme}),t.jsx(T,{}),t.jsx(E,{})]})}function R(e){const{secondaryColor:s}=o.useContext(i);let r=e.content;e.short&&e.content.length>30&&(r=e.content.substring(0,30)+"...");let n=null;return e.short&&(n=t.jsxs("div",{children:[t.jsx("br",{}),t.jsx(c.Link,{route:{route:"/view/:id",parameters:{id:e.id}},children:"View full post"})]})),t.jsxs("div",{children:[t.jsx("h3",{style:{color:s},children:e.title}),t.jsx("div",{children:r}),n,t.jsx("br",{}),t.jsxs("i",{children:["Written by ",t.jsx("b",{children:e.author})]})]})}function _(){const e=o.useSelector((e=>e.posts)),s=[];for(const r of e)s.push(t.jsxs(o.VDom.Fragment,{children:[t.jsx(R,{...r,short:!0}),t.jsx("hr",{})]}));return t.jsx("div",{children:s})}function C(){return t.jsx("div",{children:t.jsx(_,{})})}function b(e){const[r,n]=o.useState(null);return o.useEffect((()=>{var t;t=e.id,s.runSuiteQL.promise({query:"SELECT id, name AS title, custrecord_blog_content AS content, BUILTIN.DF(owner) AS author FROM customrecord_blog_post WHERE id = ?",params:[t]}).then((e=>{const t=e.asMappedResults();t.length>0&&n({id:t[0].id,data:{title:t[0].title,content:t[0].content,author:t[0].author}})}))}),[e.id]),t.jsxs("div",{children:[t.jsx(c.Link,{route:{route:"/"},children:"Go back"}),r&&r.data?t.jsx(R,{...r.data}):"Loading...",t.jsx("hr",{})]})}function L(){const[e,s]=o.useState({user:"",posts:[],error:""}),r=o.useMemo((()=>o.Store.create({reducer:u,state:e,onStateChanged:({currentState:e})=>s(e)})));o.useEffect((()=>r.subscribe((()=>s(r.getState())))),[]),o.useEffect((()=>{console.log("useEffect - fetchPosts",new Date),r.dispatch(a.fetchPosts())}),[]);const[n,c]=o.useState({primaryColor:"deepskyblue",secondaryColor:"coral"}),l={[i]:n};return t.jsx(o.Router.Hash,{children:t.jsx(o.Store.Provider,{store:r,children:t.jsx(o.VDom.Context,{value:l,children:t.jsxs("div",{children:[t.jsx(f,{setTheme:c,theme:n}),t.jsx("hr",{}),t.jsxs(o.Router.Routes,{children:[t.jsx(o.Router.Route,{path:p.HOMEPAGE,exact:!0,children:t.jsx(C,{})}),t.jsx(o.Router.Route,{path:p.POST,exact:!0,children:t.jsx(b,{})})]})]})})})})}e.run=function(e){console.log("SpaClient - run context",e),e.setLayout("application"),e.setContent(t.jsx(L,{}))}}));
