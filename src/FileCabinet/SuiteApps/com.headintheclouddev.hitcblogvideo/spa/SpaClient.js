define(["exports","@uif-js/core/jsx-runtime","@uif-js/core","N/query","N/record","N","@uif-js/component"],(function(e,t,o,n,s,r,i){"use strict";const c=o.ContextType.new("theme-context"),a={CREATE_POST:Symbol("createPost"),FETCH_POSTS:Symbol("fetchPosts"),USER_REGISTER:Symbol("userRegister"),USER_LOGIN:Symbol("userLogin"),USER_LOGOUT:Symbol("userLogout"),LOGIN_ERROR:Symbol("loginError")},u={createPost(e,t,o){const n=Date.now();return{type:a.CREATE_POST,id:n,title:e,content:t,author:o}},fetchPosts:()=>async e=>{const t=(await n.runSuiteQL.promise({query:"\n          SELECT id, name AS title, custrecord_blog_content AS content, BUILTIN.DF(owner) AS author\n          FROM customrecord_blog_post\n          WHERE isInactive = 'F'\n          ORDER BY id DESC\n        "})).asMappedResults();e({type:a.FETCH_POSTS,posts:t})},userRegister:(e,t)=>async o=>{const n=await s.create.promise({type:"contact"});n.setValue("subsidiary","1"),n.setValue("entityid",e),n.setValue("custentity_blog_password",t);const r=await n.save.promise();console.log("Successfully created contact",r),o({type:a.USER_REGISTER,username:e})},userLogin:(e,t)=>async o=>{0==(await n.runSuiteQL.promise({query:"SELECT id FROM contact WHERE entityid = ? AND custentity_blog_password = ?",params:[e,t]})).asMappedResults().length?o({type:a.LOGIN_ERROR,error:"Invalid username or password"}):(o({type:a.USER_LOGIN,username:e}),o({type:a.LOGIN_ERROR,error:""}))},userLogout:()=>({type:a.USER_LOGOUT})};function l(e,t){return{user:d(e.user,t),posts:x(e.posts,t),error:h(e.error,t)}}function d(e,t){switch(t.type){case a.USER_LOGIN:case a.USER_REGISTER:return t.username;case a.USER_LOGOUT:return"";default:return e}}function x(e,t){if(t.type==a.CREATE_POST){return[{title:t.title,content:t.content,author:t.author,id:t.id},...e]}return t.type==a.FETCH_POSTS?t.posts:e}function h(e,t){return t.type==a.LOGIN_ERROR?t.error:e}const p={HOMEPAGE:"/",POST:"/view/:id"};function m(e){return t.jsxs("span",{onClick:e.onClick,style:{cursor:"pointer",paddingLeft:"8px",fontWeight:e.active?"bold":"normal"},children:[t.jsx("span",{style:{color:e.theme.primaryColor},children:"Primary"})," / ",t.jsx("span",{style:{color:e.theme.secondaryColor},children:"Secondary"})]})}function j(e){const[n,s]=o.useState([]);function i(t){return t.primaryColor==e.theme.primaryColor&&t.secondaryColor==e.theme.secondaryColor}return o.useEffect((()=>{r.query.runSuiteQL.promise({query:"SELECT name, id, custrecord_blog_theme_secondary_color FROM customrecord_blog_theme"}).then((e=>{const t=e.asMappedResults(),o=[];for(const e of t)o.push({id:e.id,primaryColor:e.name,secondaryColor:e.custrecord_blog_theme_secondary_color});s(o),console.log("ChangedTheme found",t.length,"themes")}))}),[]),t.jsxs("div",{children:["Change Theme:",n.map((o=>t.jsx(m,{theme:o,active:i(o),onClick:()=>e.setTheme(o)})))]})}function S(){const[e,n]=o.useState(""),[s,r]=o.useState(""),c=o.useDispatch(),a=o.useSelector((e=>e.error)),l={[i.TextBox.Event.TEXT_CHANGED]:({text:e})=>{n(e)}};return t.jsxs("div",{children:[t.jsx("label",{htmlFor:"login-username",children:"Username:"}),t.jsx(i.TextBox,{type:i.TextBox.Type.TEXT,name:"login-username",text:e,on:l}),t.jsx("label",{htmlFor:"login-password",children:"Password:"}),t.jsx(i.TextBox,{type:i.TextBox.Type.PASSWORD,name:"login-password",text:s,onTextChanged:function(e){r(e.text)}}),t.jsx("input",{type:"button",value:"Login",onClick:function(){console.log("handleLogin running"),e&&s&&c(u.userLogin(e,s))}}),t.jsxs("span",{style:{color:"red"},children:[" ",a]})]})}function g(){const[e,n]=o.useState(""),[s,r]=o.useState(""),[c,a]=o.useState(""),l=o.useDispatch(),d={[i.TextBox.Event.TEXT_CHANGED]:({text:e})=>{console.log("Login username changed to",e),n(e)}};return t.jsxs("div",{children:[t.jsx("label",{htmlFor:"register-username",children:"Username:"}),t.jsx(i.TextBox,{type:i.TextBox.Type.TEXT,name:"register-username",text:e,on:d}),t.jsx("label",{htmlFor:"register-password",children:"Password:"}),t.jsx(i.TextBox,{type:i.TextBox.Type.PASSWORD,name:"register-password",text:s,onTextChanged:function(e){r(e.text)}}),t.jsx("label",{htmlFor:"register-repeat-password",children:"Repeat Password:"}),t.jsx(i.TextBox,{type:i.TextBox.Type.PASSWORD,name:"register-reeat-password",text:c,onTextChanged:function(e){a(e.text)}}),t.jsx(i.Button,{label:"Register",action:function(){console.log("handleRegister running"),l(u.userRegister(e,s))},enabled:e.length>0&&s.length>0&&s==c})]})}function y(){const e=o.useSelector((e=>e.user)),n=o.useDispatch();return t.jsxs("div",{children:["Logged in as: ",t.jsx("b",{children:e})," ",t.jsx(i.Button,{label:"Logout",action:function(){n(u.userLogout())}})]})}function T(){return o.useSelector((e=>e.user))?t.jsx(o.VDom.Fragment,{children:t.jsx(y,{})}):t.jsxs(o.VDom.Fragment,{children:[t.jsx(S,{}),t.jsx(g,{})]})}function E(){const[e,n]=o.useState(""),[s,r]=o.useState(""),c=o.useDispatch(),a=o.useSelector((e=>e.user));if(!a)return t.jsx("p",{children:"Please log in to create a post."});return t.jsxs("div",{children:[t.jsxs("div",{children:["Author: ",t.jsx("b",{children:a})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"create-title",children:"Title:"}),t.jsx(i.TextBox,{type:i.TextBox.Type.TEXT,name:"create-title",text:e,onTextChanged:function(e){console.log("handleTitle"),n(e.text)}})]}),t.jsx(i.TextArea,{text:s,onTextChanged:function(e){console.log("handleContent"),r(e.text)}}),t.jsx("input",{type:"button",value:"Create",onClick:function(){e&&s&&c(u.createPost(e,s,a))}})]})}function f(e){return t.jsxs("div",{children:[t.jsx("h1",{style:{color:e.theme.primaryColor},children:"NetSuite Blog"}),t.jsx(j,{theme:e.theme,setTheme:e.setTheme}),t.jsx(T,{}),t.jsx(E,{})]})}function R(e){const{secondaryColor:n}=o.useContext(c);let s=e.content;return e.content.length>30&&(s=e.content.substring(0,30)+"..."),t.jsxs("div",{children:[t.jsx("h3",{style:{color:n},children:e.title}),t.jsx("div",{children:s}),t.jsxs("div",{children:[t.jsx("br",{}),t.jsx(i.Link,{route:{route:"/view/:id",parameters:{id:e.id}},children:"View full post"})]}),t.jsx("br",{}),t.jsxs("i",{children:["Written by ",t.jsx("b",{children:e.author})]})]})}function C(){const e=o.useSelector((e=>e.posts)),n=[];for(const s of e)n.push(t.jsxs(o.VDom.Fragment,{children:[t.jsx(R,{...s}),t.jsx("hr",{})]}));return t.jsx("div",{children:n})}function _(){return t.jsx("div",{children:t.jsx(C,{})})}function b(e){const[s,r]=o.useState(null);return o.useEffect((()=>{var t;t=e.id,n.runSuiteQL.promise({query:"SELECT id, name AS title, custrecord_blog_content AS content, BUILTIN.DF(owner) AS author FROM customrecord_blog_post WHERE id = ?",params:[t]}).then((e=>{const t=e.asMappedResults();t.length>0&&r({id:t[0].id,data:{title:t[0].title,content:t[0].content,author:t[0].author}})}))}),[e.id]),t.jsxs("div",{children:[t.jsx(i.Link,{route:{route:"/"},children:"Go back"}),s&&s.data?t.jsx(R,{...s.data}):"Loading...",t.jsx("hr",{})]})}function L(){const[e,n]=o.useState({user:"",posts:[],error:""}),s=o.useMemo((()=>o.Store.create({reducer:l,state:e,onStateChanged:({currentState:e})=>n(e)})));o.useEffect((()=>s.subscribe((()=>n(s.getState())))),[]),o.useEffect((()=>{console.log("useEffect - fetchPosts",new Date),s.dispatch(u.fetchPosts())}),[]);const[r,i]=o.useState({primaryColor:"deepskyblue",secondaryColor:"coral"}),a={[c]:r};return t.jsx(o.Router.Hash,{children:t.jsx(o.Store.Provider,{store:s,children:t.jsx(o.VDom.Context,{value:a,children:t.jsxs("div",{children:[t.jsx(f,{setTheme:i,theme:r}),t.jsx("hr",{}),t.jsxs(o.Router.Routes,{children:[t.jsx(o.Router.Route,{path:p.HOMEPAGE,exact:!0,children:t.jsx(_,{})}),t.jsx(o.Router.Route,{path:p.POST,exact:!0,children:t.jsx(b,{})})]})]})})})})}e.run=function(e){console.log("SpaClient - run context",e),e.setLayout("application"),e.setContent(t.jsx(L,{}))}}));
